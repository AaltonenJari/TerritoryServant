<?php
if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Settings_model extends CI_Model
{
    function __construct() {
        parent::__construct();
    }
    
    public function search($fields, $sort_by, $sort_order)
    {
        $sort_order = ($sort_order == 'desc') ? 'desc' : 'asc';
        
        $sort_columns = array();
        foreach ($fields as $field_name => $field_display) {
            $sort_columns[] = $field_name;
        }
        $sort_by = (in_array($sort_by, $sort_columns)) ? $sort_by : 'setting_order_id';
        
        $fetch_columns = array();
        foreach ($fields as $field_name => $field_display) {
            $fetch_columns[] = $field_name;
        }
        
        // Results query
        $query = $this->db->select($fetch_columns)
        ->from('settings');
        
        //JÃ¤rjestys
        switch ($sort_by) {
            case "setting_order_id":
            case "setting_admin":
            case "setting_input_type":
            case "setting_input_id":
                $query = $this->db->order_by($sort_by, $sort_order);
                break;
                
            case "setting_desc":
            case "setting_value":
                //$query = $this->db->order_by("setting_admin", "DESC");
                $query = $this->db->order_by("setting_order_id", $sort_order);
                break;
            
            default:
                $query = $this->db->order_by("setting_order_id", "ASC");
                break;
        } // switch
        
        
        $ret['rows'] = $query->get()->result();
        
        //count cuery
        $ret['num_rows'] = count($ret['rows']);
        
        return $ret;
    }
    
    public function set_settings($results)
    {
        $settings_data = array();
        foreach ($results['rows'] as $fetched_row) {
            
            $resultrow = new stdClass;
            foreach ($fetched_row as $key=>$value) {
                switch ($key) {
                    case "setting_value":
                        $settings_data[$fetched_row->setting_input_id] = $value;
                        break;
                        
                    case "setting_input_id":
                        break;
                        
                    default:
                        break;
                } // switch
            } // foreach results row
        }
        
        //Muodostettu asetus session-muuttujiin
        $this->session->set_userdata($settings_data);
        return ;
        
    }
    
    
    function get_row_by_key($columns, $key)
    {
        // Results query
        $query = $this->db->select($columns)
        ->from('settings');
        
        $this->db->where('setting_id', $key);
        
        $reault_array = $this->db->get()->result_array();
        
        return $reault_array[0];
    }
    
    public function insert($data) {
        if ($this->db->insert("settings", $data)) {
            return true;
        }
    }
    
    public function delete($key) 
    {
        $this->db->where('setting_id',$key); 
        $result = $this->db->delete('settings');
    }
    
    public function update($data, $key) 
    {
        $this->db->set($data);
        $this->db->where("setting_id", $key);
        $this->db->update("settings", $data);
    }
    
}