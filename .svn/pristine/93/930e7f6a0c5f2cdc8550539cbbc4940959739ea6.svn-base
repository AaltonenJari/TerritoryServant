<?php
class LoginController extends CI_Controller {
    public function index() {
        $this->load->view('login');
    }
    
    public function checkLogin() {
        
        //$this->form_validation->set_rules('username', 'Username', 'required:valid_email');
        //$this->form_validation->set_rules('password', 'Password', 'required:callback_verifyUser');
        
        // set validation rules
        $rules = array(
            array('field' => 'username',
                'label' => 'Username',
                'rules' => 'required') ,
            array('field' => 'password',
                'label' => 'Password',
                'rules' => 'required|callback_verifyUser')
        ) ;
        
        $this->form_validation->set_rules($rules);
        
        if ($this->form_validation->run() == false) {
            $this->load->view('login');
        } else {
            $new_url = "Territory_controller/display_frontpage/";
            redirect($new_url);
        }
        
   }
   
   public function verifyUser() {      
       $name = $this->input->post('username');
       $pass = $this->input->post('password');
    
       $this->load->model('LoginModel');
    
       if ($this->LoginModel->Login($name, $pass)) {
           $session_data = array(
               'username' => $name
           );
           $this->session->set_userdata($session_data);
           return true;
       } else {
           $this->form_validation->set_message('verifyUser','Incorrect username or password, please try again.');
           $this->session->set_flashdata('error', 'Invalid Username and Password');
           return false;
       }
   }
   
   public function logout() {
       $this->session->unset_userdata('username');
       $this->load->view('login');
   }
}